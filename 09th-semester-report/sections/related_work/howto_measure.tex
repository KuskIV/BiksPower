% How to measure the energy consumption of code

\section{Different Measuring Instruments}\label[section]{sec:rw_diff_measuring_instruments}
Energy measurements are needed to be able to compare the energy consumption of e.g. different language constructs. However, there are several methods to get these measurements. In this section some work focused on different measuring instruments is presented.

%\subsection*{Software based measuring instruments}

One such work is the work by Jagroep et al.\cite[]{Jagroep2015} which compares different software-based measurement instruments. This work evaluates different measurement instruments through a series of experiments on both idle and full load scenarios where the estimated energy consumption is compared to the actual consumption as reported by hardware measurements. Here it is noted that despite having access to roughly the same data the results can differ significantly between the different measurement instruments. The study includes 14 different measurement instruments, picked based on four criteria. These include: at least a beta version has to be available, it has to be able to sample at least once per second, it has to run on Linux or Windows and it has to be compatible with their hardware. They do however have some issues when trying to download and set up most of the measuring instruments, and only successfully use two measuring methods one on Windows 7 and one on Ubuntu 12.04. Both were found to be inaccurate.\cite*{Jagroep2015} \newline

Another work which aims to analyze Intel's RAPL compared with a hardware-based measuring instrument is the work by Khan et al.\cite*[]{RAPL_in_action}. In this work, they argue the advantages and disadvantages are yet to be fully uncovered, which is what they aim to do. This is achieved on an Intel Skylake and an Intel Haswell CPU, which also uncovers the differences, where the newer versions are deemed more optimized. The key findings of the work are first of all in regards to the accuracy of RAPL, where they find the correlation between the wall power and the package power from RAPL to be $0.99$ for the Haswell machine. In addition to this, the overhead of RAPL is deemed low and negligible through experiments. This was done by pinning the benchmark and RAPL on the same core, and analyzing if the benchmark would slow down depending on the sampling rate of the measurement program, where with the highest sampling rate, the performance overhead is still less than $2\%$. The work also analyzes what impact the temperature has on the power consumption measured by RAPL, where the correlation coefficient between this was found to be $0.34$ and $0.93$ for Skylake and Haswell respectively, meaning the temperature does measurably impact the power consumption, especially for the older Haswell processor. One big advantage of RAPL, as argued by Khan et al.\cite*[]{RAPL_in_action}, is the sampling rate of $1.000$Hz. This sampling rate is argued to be much higher than most external power meters and enables RAPL to distinguish between different phases within the benchmark. This sampling rate is however also one of the roots of errors in RAPL, as the measurements are inconsistent and non-atomic. According to the documentation, RAPL updates every $0.976$ms, but this value deviates and is overall found to be closer to $1$ms. Because of this, cases can occur where the energy is measured at a consistent interval and will contain a different number of updates, resulting in spikes in energy consumption. And since RAPL does not give any timestamps on updates, it is difficult to say when updates are made, unless a check is made more often than every $1$ms, resulting in some sampling being made without it being an update, but these values are removed. The work\cite*[]{RAPL_in_action} also notes things like poor driver support, the inability to measure the energy consumption from a single core and the static sampling rate of $1.000$ as disadvantages with RAPL.\cite*{RAPL_in_action}\nytafsnit

% In the work by Hackenberg et al.\cite*[]{hackenberg2013} Intelligent Platform Management Interface (IMPI) based platforms like power supplies with measurement features, model-based interfaces like RAPL or APM and physical measurements including AC and DC are compared, with an aim of uncovering aspects of accuracy, temporal resolution and measurement overhead.

% Here it is noted that Intel's RAPL has previously been shown to be reasonably accurate, and is deemed a viable alternative to physical measurements\cite*[]{Dongarra2012,hackenberg2013}.

%\subsection*{Hardware based measuring instruments}

\input{sections/related_work/Hackenberg.tex}

\input{sections/related_work/Fahad.tex}



% When measuring the energy consumption of a process, different energy profilers exist that have been used in existing work. One popular approach is model-based power consumption estimators provided by x86 microprocessors, including Intel's RAPL for intel chips, and Application Power Management (APM) for AMD.

% \todo{I think this sentence is weird.}Work exists for RAPL, here it is deemed a viable alternative to physical measurements, where it consistently under-estimates\cite[]{Dongarra2012, Hackenberg2013}, but it does have some limitations, as RAPL values are not physical measurements, it is rather based on modelling approach\cite[]{Hackenberg2013}. Another limitation is how RAPL returns energy data and not power data. Because of this, the average update interval is used as timestamps for each update, and this value is assumed to be accurate enough.\cite[]{Hackenberg2013}

% When considering APM, it is reasonably accurate but suffers from for example systematic inaccuracies most likely caused by novelty of the interface.\cite[]{Hackenberg2013}


% When measuring the energy consumption using hardware, it can be done on either AC or DC. When measuring AC, the measuring device is located between the power supply and the electrical outlet, and for DC it is from the power supply to the system.\cite[]{Hackenberg2013} Another hardware approach could also be using the Watts Up Pro power consumption meter, also used in multiple works as it has a very high accuracy of $1.5\%$.\cite[]{Jagroep2015}\nytafsnit

%% Intel Energy Checker SDK
%% Application Power Management for AMD


%% FEETINGS: Framework for Energy Efficiency Testing to Improve Environmental Goal of the Software:


%%\input{sections/related_work/Hackenberg.tex}