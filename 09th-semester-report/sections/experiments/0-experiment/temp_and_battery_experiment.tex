\subsection{Temperature and Battery Experiment}\label[subsec]{subsec:TempBat}

One thing to consider before running the experiments is to determine some values for the configuration. This includes at what range of temperature and what range of battery charge the DUT can be within without degrading performance. The reason why the experiments are not executed on all levels of battery charge is based on the work by Bokhari et al.\cite[]{Bokhari2020r3} where experiments were only run when the battery charge was above a certain limit, as the DUT would otherwise enter power saving mode. Because of this, the hypothesis will be that a similar observation can be made on laptops. Another parameter that can make the DUT underperform is the temperature, as was noted in the work by Lindholt et al.\cite[]{Lindholt2022}. For this experiment, some expectations will first be presented, before the results will be discussed. When considering how the temperature and battery levels are measured, it will be done through the OS on Linux. This is however not possible on Windows. Therefore, a software solution is needed. One software solution with this capability is LHM which is chosen in our work. When considering the different measuring instruments, LHM was not the only one able to measure the temperature. LHM was however chosen for all temperature measurements in Windows to ensure all measurements were done in the same way to make the results more comparable.

\paragraph{Expectations:} Based on these two parameters, the assumption would be that there is some lower limit on the battery where the CPU is underclocked, and some upper limit for the temperature where the CPU will thermal throttle, resulting in a worse performance. For the temperature this is based on the work by Khan et al.\cite[]{RAPL_in_action}, where a correlation between temperature and performance was found for RAPL. To find these values, the test cases will be executed on all DUTs, and the battery and temperature will be measured before and after running the test case.

\paragraph{Issues:} When running the experiments to determine the temperature and battery, some different issues came up. These were as follows:

\begin{itemize}
    \item Intel Power Gadget: This measuring instrument would sometimes cause the framework to crash. This occurred more frequently on some DUTs, but without any observable pattern. The errors were most likely caused by the Intel Power Gadget API, implemented in c++, which meant the error could not be caught within C\#, despite sources claiming this\cite[]{cpp_exceptions}. We were unable to replicate the error inside an IDE, and the error would close the terminal window down immediately, which meant it was impossible to see or log the specific error. To solve this, different versions of Intel Power Gadget were tested, but without success. %The error was however most likely related to Intel Power Gadget accessing some memory it was not supposed to.
    \item LHM: This measuring instrument reached a limit of how often it could sample. LHM is implemented through the official GitHub\feetnote{https://github.com/LibreHardwareMonitor/LibreHardwareMonitor} but threw exceptions if values were read more than every $500$ms.
    \item Startup: When reading certain values and disabling the WiFi, the framework was required to run with administrator privileges on Windows. It was however not possible to start the framework automatically with administrator privileges in Windows, despite attempting to disable notifications about changes on the computer. 
    \item Battery level: One of the DUTs was unable to charge fully up. We believe this is because it is an old battery as it is common for batteries to degrade over time. When running batteryreport on Windows it reports the capacity of the battery has decreased to $\approx87$ of the design capacity. Which is close to the max battery percentage we are able to get.
    \item No battery: During the experiments, there were issues with the battery-powered DUTs running out of power, and shutting down. This could be related to the DUTs being older devices and thus shutting down before reaching 0\% battery.
\end{itemize}

To solve this, a few measures were taken:

\begin{itemize}
    \item Background script: To handle cases where the framework crashed without any warning, a script was introduced on Windows. This script would run every 20 minutes, to ensure the framework was running. If it was not, it would restart the DUT. This script was implemented in PowerShell and would affect the energy measurements, but as the energy consumption of the script is consistent across all measurements, it should be removed from the energy measurements when using dynamic energy.
    \item AutoHotKey: To solve the issue of the framework not being able to run on startup, an AutoHotKey script was used. This would execute the framework one minute after the DUT was started, to ensure the DUT was in a stable condition. After the script has been executed once, it would shut down, thus not affecting the energy consumption during the experiment.
    \item LHM: Because of the issues with LHM, the sampling rate was raised to every $500$ms, which was found to be stable.
    \item Battery level: Because of the issues both with low and high battery levels, some limits were set before the experiments were run. This was done to ensure the DUT would not stop prematurely because a DUT would charge forever, or would shut down. These values were set similarly across all DUTs, with a battery, to make them more comparable. The DUT facing issues with charging to 100\% could charge to almost 90\%. Because of this, 80\% was chosen, to ensure it would work. For the lower limit, some different values were tested, where the issues occurred at both 5\%, 10\%, 20\%, and 30\%. Because of this, 40\% was chosen as the battery level the DUT could not go below.
\end{itemize}

A thing to note is that both scripts described are used in all experiments on Windows devices. Following this, the experiments were conducted.

\input{tabels/experiment_results/exp_one/graphs/charge/without_outliers/Cores/FannkuchRedux.tex}

\paragraph{Battery level:} When considering the impact of the battery level on the performance, FannkuchRedux was arbitrarily picked to illustrate this and can be seen in \cref{fig:FannkuchRedux_Cores_charge}. Only one test case is chosen in this case, as similar conclusions can be made on the other test cases, which can be found in \cref{app:charge}. When looking at the graph, a slight decrease in energy consumption can be observed when the battery level increases, like Intel Power Gadget for Surface Pro 4. The overall conclusion for the impact of energy is however concluded to be negligible when the battery is above 40\%. Based on this, the experiments will be executed with a lower limit of 40\% and an upper limit of 80\%.

\input{tabels/experiment_results/exp_one/graphs/temperature/without_outliers/Cores/FannkuchRedux.tex}

\paragraph{Temperature:} When looking at the impact of the temperature on the energy performance, FannkuchRedux was chosen again to illustrate this, as can be observed in \cref{fig:FannkuchRedux_Cores_temperature}. The other test cases can be found in \cref{app:temperature}, where a similar pattern in the data can be observed. When considering the graph in \cref{fig:FannkuchRedux_Cores_temperature}, a few things can be observed. The temperatures for example never exceed 65 degrees Celsius on any of the DUTs, and the highest temperature for the workstation is even lower. This is partly because the workstation had full fan speed during all experiments, which was not possible in the laptops. Based on the expectations, an increase in power was expected to be observed when the temperature increased, which did not occur. When looking at the results, no impact can be observed, which is why no limits are set for the temperature going forward.