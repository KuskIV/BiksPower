\subsection{Measurement Methodology}\label[subsec]{subsec:mm}

% When running the experiments, different types of measuring approaches will be used, based on the hardware represented in \cref{sec:hardware}. The first approach is system-level physical measurements, where AC measurements was chosen using the clamp presented in \cref{subsec:Equipment}. AC measurements were found in \cref{sec:rw_diff_measuring_instruments} to be the most accurate way to measure the energy consumption of the DUT\[]{Was DC better?}. This approach will serve as the ground truth for the experiments conducted.\newline

% Another approach is the model-based interface, where on-chip sensors are used. For this, \cref{sec:rw_diff_measuring_instruments} found that RAPL is a frequently used version of this. RAPL however only works on Linux, as was covered in \cref{subsec:rapl}, and since our work aims to find the accuracy of Windows approaches, some additional energy profilers were introduced in \cref{sec:measuring_instruments}. RAPL is however still included, as it also serves as a good benchmark in terms of what is possible when considering only software measurements. When considering the Windows energy profilers, the LHM and Intel Power Gadget are very similar to both RAPL and the physical measurements, as they find the total energy consumption of the entire system. Here E3 is different, as this profiler can estimate the energy consumption on a process-to-process level, and also claims to be able to benefit from hardware chips, if the DUT is equipped with such one.\cite{E3WinHec} E3 however also comes with some uncertainty, which is covered in \cref{sec:E3Experiments}.

% Given RAPL, Intel Power Gadget, LHM and the physical measurements only provide the energy consumption of the entire system, the idle energy consumption is required for this experiment, to extract the energy consumption of the test program only. To solve this, dynamic energy consumption can be utilized, as presented by Fahad et al.\cite{fahad2019comparative}, which was covered in \cref{sec:rw_measureing_methodology_setup} dynamic energy consumption is an estimation of the applications power consumption and is calculated using \cref{eq:dynamicEnergy}

When running the experiments, different types of measuring instruments are used, as is presented in \cref{sec:measuring_instruments}. Representing hardware measurements, a clamp was found in \cref{subsec:Equipment}, which was able to fit the needs presented in our work, in \cref{subsec:HardwareMeasurementsIntro}.\newline

The ground truth as measured by the clamp will be compared against different software-based measuring instruments. The software-based measuring instruments will in our work be RAPL, Intel Power Gadget, LHM, and E3 found in \cref{sec:measuring_instruments}. Here RAPL represents the state of the art measuring instrument, based on the literature covered in \cref{ch:related_work}. One limit of RAPL is however how this measuring instrument is limited to Linux, which is why Intel Power Gadget, LHM, and E3 were chosen as additional measuring instruments, as these all work on Windows. Between the different measuring instruments, RAPL, Intel Power Gadget, and LHM are similar, as they measure the entire energy consumption of the CPU. To isolate the energy consumption of the test case, the notion of dynamic energy is introduced, as presented by Fahad et al.\cite{fahad2019comparative}, covered in \cref{sec:rw_measureing_methodology_setup}, which requires the idle energy consumption. Opposed to this, E3 is different as it is able to estimate the energy consumption of each process running on the CPU.\newline

When conducting the experiments aiming to compare the different measuring instruments, some specefic control over the DUT is required. This control is based on a combination of what was presented in \cref{sec:rw_measureing_methodology_setup} by Sestoft\cite[]{sestoft2013microbenchmarks} and Fahad et al.\cite[]{fahad2019comparative}, and are as following:

\begin{itemize}
    \item The DUT is reserved exclusively for the experiments, this is to prevent deviations in the results.
    \item The networking will be disabled on the machines to ensure that these do not affect the results.
    \item The processes and the temperature in degrees Celsius of the machines will be measured before and after each experiment.
    \item After each batch \feetnote{A set of test cases executed in sequence with a cooling of periods, as presented in \cref{tab:TerminologyAlert}}, the DUT will be restarted and its setup phase is performed before continuing to the next batch.
    \item The memory of the test cases will not exceed the DUTs main memory to avoid memory swapping
    \item Some baseline power usage will be established by measurements before and after the experiments
    \item The generation of logging and debug messages can use more than 90\% of execution time, so this has to be disabled
    \item Disable power-saving schemes so the CPU does not reduce its speed during benchmark runs.
    \item Reflect on results, and if they look slow/fast something might have been overlooked.
\end{itemize}

Each batch will be tested on every DUT with each type of OS, these being Windows and Linux. Each DUT will have a slightly different setup depending on the hardware and the OS of the system. Some unnecessary background processes will be disabled to ensure as little noise in the measurements as possible\cite[]{sestoft2013microbenchmarks}, the specific process disabled can be seen in \cref{tab:disabled_proc}. These processes were picked based on observing which processes were executing in the background and picking out the irrelevant processes to be disabled. It can be noted that there are no disabled background processes for Linux, which was the case because no unnecessary background processes were observed. A few additional things to note here are that all DUTs are run on a fresh install of the OS to limit the number of background processes, and for DUTs with a battery, the energy mode was set to performance. The reason why performance was chosen was that the different DUTs had a different number of modes. The Surface Book has three modes, while the Surface Pro 4 has four. Performance was therefore chosen to make the DUTs comparable, and get the best performance. A difference between the DUTs is whether they are desktops or laptops, whereas on the desktop it is possible to perform system-level physical measurements. Because the clamp measures the energy consumption of the entire system and not just the CPU, it is important to limit the power fluctuation related to other components of the DUT, as this can impact the result. This power fluctuation is limited by setting the fan speed to max on the desktop and removing the external GPU. For the laptops, this is not an issue as the measurements do not include the whole system.

\input{tabels/disabled_Processes.tex}
