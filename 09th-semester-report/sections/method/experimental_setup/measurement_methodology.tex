\subsection{Measurement Methodology}\label[subsec]{subsec:mm}

% When running the experiments, different types of measuring approaches will be used, based on the hardware represented in \cref{sec:hardware}. The first approach is system-level physical measurements, where AC measurements was chosen using the clamp presented in \cref{subsec:Equipment}. AC measurements were found in \cref{sec:rw_diff_measuring_instruments} to be the most accurate way to measure the energy consumption of the DUT\todo[]{Was DC better?}. This approach will serve as the ground truth for the experiments conducted.\newline

% Another approach is the model-based interface, where on-chip sensors are used. For this, \cref{sec:rw_diff_measuring_instruments} found that RAPL is a frequently used version of this. RAPL however only works on Linux, as was covered in \cref{subsec:rapl}, and since this work aims to find the accuracy of Windows approaches, some additional energy profilers were introduced in \cref{sec:measuring_instruments}. RAPL is however still included, as it also serves as a good benchmark in terms of what is possible when considering only software measurements. When considering the Windows energy profilers, the LHM and Intel Power Gadget are very similar to both RAPL and the physical measurements, as they find the total energy consumption of the entire system. Here E3 is different, as this profiler can estimate the energy consumption on a process-to-process level, and also claims to be able to benefit from hardware chips, if the DUT is equipped with such one.\cite{E3WinHec} E3 however also comes with some uncertainty, which is covered in \cref{sec:E3Experiments}.

% Given RAPL, Intel Power Gadget, LHM and the physical measurements only provide the energy consumption of the entire system, the idle energy consumption is required for this experiment, to extract the energy consumption of the test program only. To solve this, dynamic energy consumption can be utilized, as presented by Fahad et al.\cite{fahad2019comparative}, which was covered in \cref{sec:rw_measureing_methodology_setup} dynamic energy consumption is an estimation of the applications power consumption and is calculated using \cref{eq:dynamicEnergy}

When running the experiments, different types of measuring instruments are used, as is presented in \cref{sec:measuring_instruments}. Representing hardware measurements, a clamp was found in \cref{subsec:Equipment}, which was able to fit the needs presented in this work, in \cref{subsec:HardwareMeasurementsIntro}.\newline

The ground truth as measured by the clamp, will be compared against different software measurement instruments. The software measurement instruments will in this work be RAPL, Intel Power Gadget, LHM and E3, found in \cref{sec:measuring_instruments}. Here RAPL represents the state of the art measuring instrument, based in the literature covered in \cref{ch:related_work}. One limit of RAPL is however how this measuring instrument is limited to Linux, which is why Intel Power Gadget, LHM and E3 were chosen as additional measuring instruments, as these all work on Windows. Between the different measuring instruments, RAPL, Intel Power Gadget and LHM are similar, as they measure the entire energy consumption of the CPU. In order to isolate the energy consumption of the test case, the notion of dynamic energy is introduced, as presented by Fahad et al.\cite{fahad2019comparative}, covered in \cref{sec:rw_measureing_methodology_setup}, which requires the idle energy consumption. Opposed to this, E3 is different as it is able to estimate the energy consumption of each process running on the CPU.\newline

When conducting the experiments aiming to compare the different measuring instruments, control over the DUT is required. The control include some aspects only relevant for certain DUTs and OSs, where all are relevant for all. This control is based on a combination of what was presented in \cref{sec:rw_measureing_methodology_setup} by Sestoft\cite[]{sestoft2013microbenchmarks} and Fahad et al.\cite[]{fahad2019comparative}, and are as following:

\begin{itemize}
    \item The DUT are reserved exclusively for the experiments, this is to prevent divinations in the results.
    \item The networking will be disabled on the machines to ensure that these do not affect the results.
    \item The processes and the temperature in degrees Celsius of the machines will be measured before and after each experiment.
    \item After each batch\todo[]{this is the first time batch is presented. maybe introduce somehow}, the DUT will be restarted and its setup phase is performed before continuing to the next batch.
    \item The memory of the test cases will not exceed the DUTs main memory to avoid memory swapping
    \item Some baseline power usage will be established by measurements before and after the experiments
    \item The generation of logging and debug messages can use more than 90\% of execution time, so this has to be disabled
    \item Disable power-saving schemes so the CPU does not reduce its speed during benchmark runs.
    \item Reflect on results, and if they look slow/fast something might have been overlooked.
\end{itemize}

Each batch will be tested on every DUT with each type of OS, these being Windows and Linux. Each DUT will have a slightly different setup depending on the hardware and the OS of the system. Some unnecessary background processes will be disabled to ensure as little noise in the measurements as possible\cite[]{sestoft2013microbenchmarks}, the specific process disabled can be seen in \cref{tab:disabled_proc}. These processes were picked based on observing which processes were executing in the background, where processes not relevant were disabled. It can be noted how there are no disabled background processes for Linux, which was the case because no unnecessary background processes were observed. A few additional things to note here is that all DUT's are run on a fresh install of the OS to limit the number of background processes, and for DUTs with a battery, the energy mode was set to performance. The reason why performance was chosen was because the different DUTs had a different number of modes. The Surface Book for example has three modes, while the Surface Pro 4 has only four. Performance was therefor chosen to make the DUTs comparable, and getting the best performance. A difference between the DUTs is whether they are desktops or laptops, where on the desktop it is possible to perform system-level physical measurements. Because the clamp measure the energy consumption of the entire system and not just the CPU, it is important to have a limited power fluctuation related to other components of the DUT than the CPU, as this will impact the result. This power fluctuation is limited by setting the fan speed to max on the desktop. For the laptops, this is not an issue as the measurements do not include the whole system.\todo[]{This part seems out of place, as many of these things has been covered other places.}

\input{tabels/disabled_Processes.tex}
