\subsection{SQL}\label[subsec]{subsec:sql}

When considering existing work as presented in \cref{ch:related_work}, most existing work save data in comma-separated files(CSV)\cite[]{Koedijk2022diff,Pereira2017}. This will however not be done in this work, as we argue SQL will improve the workflow and the ability to analyze the data. This is especially clear when a lot of data is to be analyzed, from different DUTs, test cases and measuring instruments. Relational data like this, where one test case, DUT, measuring instrument and configuration can be used in zero or more experiments are an ideal use case for SQL, where it enables the user to process the data later in an optimized manner\cite[]{Silberschatz2019}. In this case, the test case, measuring instrument, DUT and configuration will be contained in their own tables, to avoid replicated data, and makes it possible to add, remove or update the attributes within the table, as long as the id remains the same. Here the id will be an auto-incremented integer, meaning no situation should arise where it makes sense to alter this value, and will for all tables represent the primary key, and be used as a foreign key, when other tables reference it. In addition to the inputs to an experiment (test case, DUT, configuration and measuring instrument), the outputs will also be in their own respective tables. These tables will include the measurement of the profiler (raw data), a time series, and zero or more measurements. The structure of the data can be seen in \cref{fig:uml_diagram} and is used for two things during the experiments. The first thing is to capture the results, where a connection to the database will be made after each run of the experiments, to upload the data. The connection is then shut down again, before the next run, to avoid using energy on this, which could affect the results. The relevant components for capturing results from \cref{fig:uml_diagram} are as following:

\begin{itemize}
    \item Test case: Represents what test program was used in the experiment through a unique ID, name and what language it was implemented in.
    \item Measuring instrument: Represents what measuring instrument was used in the experiment through a unique ID and name
    \item DUT: Represents which hardware specifications the test case was executed on through a unique ID, name, operating system and version\feetnote{The version is to separate different versions of the framework. Meaning each time a change is made to the framework, the version increments.}. 
    \item RawData: Represents the output from the measuring instrument, in the experiment. This is represented through a unique ID, an experiment ID, a value and the date of execution. The value here is a serialized object representing the data, as the different measuring instruments had different formats in their output. The raw data will represent the sum over the entire duration of the experiment, meaning how much energy was consumed as a single value.
    \item TimeSeries: Also represents the output from the measuring instrument in the experiment in a similar manner as in RawData. The difference is how the values will be a time series during the entire runtime of the experiment, with some interval between the data points. This can be used to analyze during which parts of the test case the most energy is consumed.
    \item Configuration: Represents what configuration was used during the experiments. Here min/max temp and battery represent the limits the system had to exceed before the results were no longer useful, and a system restart and cooldown period are required. Between represents the cooldown period between two test case runs in minutes, and duration specifies the minimum duration the test case had to run for denoted in minutes. This is also represented through a unique ID.
    \item Measurement: Represents a measurement made on the system during the experiments. The measurement is represented through a unique ID, an experiment ID, a time, a type, a name and a value. Here the name is the sensor name e.g. 'CORE \#1', and the type is more general like 'CpuTemperature'. This table is made general so both battery, temperatures and others can fit in the same table.
    \item Experiment: The experiment ties all other tables together, where one experiment is represented with a unique ID, configuration ID, measuring instrument ID, DUT ID, test case ID and start/end times. This enables one experiment to have multiple measurements, one program to be used in several experiments etc. In addition to this, runs represent how many times the test case is executed to run for at least the configurations duration value, and iteration represents how many times the test case has been measured at the given point in time, by the given measuring instrument since the last restart of the computer. This is relevant for the R3-Validation, where for the first ABC, the iteration will be 1 for all measuring instruments, the second BCA will be 2 etc.
\end{itemize}

One thing of focus when creating the database, was to make it as generic as possible. This is why the measurement table is as it is, to facilitate different kinds of measurements. This can also be seen when considering the test case, where it is noted what language it is implemented in, to make it possible to include different languages, if it is deemed important for the experiments.


The second use case for the data is to save the state of the program upon a restart. This is relevant for R3-Validation, where after each restart, a new measuring instrument needs to start. The relevant tables for this are as follows:

\begin{itemize}
    \item Test case: Same definition as before
    \item DUT: Same definition as before
    \item Run: Represents what measuring instrument was the first measuring instrument last time an experiment was run on for a given test case on a given DUT. This is represented using a unique run ID, a test case ID and a DUT ID. In addition to this is the value, which represents the different measuring instruments used in the experiment, and which one started last time.
\end{itemize}

\input{figures/sql_uml_diagram.tex}